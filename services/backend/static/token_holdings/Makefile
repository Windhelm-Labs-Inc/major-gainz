.PHONY: help install test production interactive export

# Default target
help:
	@echo "Token Holdings Tracking System"
	@echo "==============================="
	@echo ""
	@echo "Available commands:"
	@echo "  make install     - Setup environment and install dependencies"
	@echo "  make test        - Run all tests (unit + integration)"
	@echo "  make production  - Build production database (unlimited accounts, \$$1 USD min)"
	@echo "  make interactive - Interactive refresh mode (prompts for old data)"
	@echo "  make export      - Export all token data to CSV files"
	@echo ""
	@echo "Examples:"
	@echo "  make install && make production  # Setup and build production DB"
	@echo "  make interactive                 # Smart refresh with prompts"
	@echo "  make export                      # Export current data to CSV"

# Install and setup
install:
	@echo "ðŸ”§ Setting up Token Holdings System..."
	@echo "ðŸ“¦ Installing Poetry dependencies..."
	poetry install --with dev
	@echo "ðŸ”§ Initializing database..."
	poetry run python -m src.cli init
	@echo "ðŸ“Š Checking system status..."
	poetry run python -m src.cli status
	@echo "âœ… Installation completed!"

# Run all tests
test:
	@echo "ðŸ§ª Running all tests..."
	poetry run pytest --cov=src --cov-report=term-missing
	@echo "âœ… All tests completed!"

# Production database build
production:
	@echo "ðŸ—ï¸  Building production database..."
	@echo "  ðŸ“Š Unlimited accounts per token"
	@echo "  ðŸ’° Minimum USD filter: \$$1.00"  
	@echo "  ðŸª™ All enabled tokens (HBAR, SAUCE, KARATE)"
	@echo ""
	poetry run python -m src.cli refresh --min-usd 1 --export-csv
	@echo ""
	@echo "ðŸ“Š Production database status:"
	poetry run python -m src.cli status
	@echo "âœ… Production database build completed!"

# Interactive mode
interactive:
	@echo "ðŸ¤” Starting interactive refresh mode..."
	@echo "  ðŸ“… Checks data age and prompts for updates"
	@echo "  ðŸ”„ Smart refresh for tokens older than 24 hours"
	@echo "  ðŸ“‹ Batch processing with confirmation"
	@echo ""
	poetry run python -m src.cli refresh --interactive --export-csv
	@echo "âœ… Interactive refresh completed!"

# Export data
export:
	@echo "ðŸ“„ Exporting all token data to CSV..."
	poetry run python -m src.cli export
	@echo "ðŸ“Š Exporting summary of all tokens..."
	poetry run python -m src.cli export --summary
	@echo "ðŸ“ Checking exported files..."
	@ls -la temp_data/ 2>/dev/null || echo "No temp directory found"
	@echo "âœ… Export completed!" 